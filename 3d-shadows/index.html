<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Cube with Soft Shadows</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { overflow: hidden; background: #000; font-family: monospace; }
  canvas { display: block; }
  #controls {
    position: absolute;
    top: 12px;
    right: 12px;
    background: rgba(0,0,0,0.75);
    color: #ccc;
    padding: 14px 18px;
    border-radius: 8px;
    width: 220px;
    user-select: none;
  }
  #controls h3 { margin-bottom: 10px; color: #fff; font-size: 14px; }
  #controls label { display: block; margin-top: 8px; font-size: 12px; }
  #controls input[type=range] { width: 100%; margin-top: 2px; }
  #controls .val { float: right; color: #8cf; }
</style>
</head>
<body>

<div id="controls">
  <h3>Spotlight Controls</h3>

  <label>X Position <span class="val" id="vx">4</span></label>
  <input type="range" id="sx" min="-10" max="10" step="0.1" value="4">

  <label>Y Position <span class="val" id="vy">8</span></label>
  <input type="range" id="sy" min="1" max="15" step="0.1" value="8">

  <label>Z Position <span class="val" id="vz">4</span></label>
  <input type="range" id="sz" min="-10" max="10" step="0.1" value="4">

  <label>Target X <span class="val" id="vtx">0</span></label>
  <input type="range" id="tx" min="-5" max="5" step="0.1" value="0">

  <label>Target Y <span class="val" id="vty">0</span></label>
  <input type="range" id="ty" min="-5" max="5" step="0.1" value="0">

  <label>Target Z <span class="val" id="vtz">0</span></label>
  <input type="range" id="tz" min="-5" max="5" step="0.1" value="0">

  <label>Cone Angle <span class="val" id="va">45°</span></label>
  <input type="range" id="angle" min="5" max="90" step="1" value="45">

  <label>Penumbra (softness) <span class="val" id="vp">0.5</span></label>
  <input type="range" id="penumbra" min="0" max="1" step="0.01" value="0.5">

  <label>Intensity <span class="val" id="vi">150</span></label>
  <input type="range" id="intensity" min="10" max="500" step="5" value="150">
</div>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/"
  }
}
</script>

<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

// --- Renderer ---
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
renderer.shadowMap.enabled = true;
renderer.shadowMap.type = THREE.PCFSoftShadowMap;
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 1.0;
document.body.appendChild(renderer.domElement);

// --- Scene & Camera ---
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x1a1a2e);
scene.fog = new THREE.FogExp2(0x1a1a2e, 0.02);

const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 100);
camera.position.set(8, 8, 12);

const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;
controls.target.set(0, 1, 0);

// --- Ambient light (subtle fill) ---
scene.add(new THREE.AmbientLight(0x404060, 0.4));

// --- Materials ---
const planeMat = new THREE.MeshStandardMaterial({ color: 0x888899, roughness: 0.8, metalness: 0.1 });
const cubeMat  = new THREE.MeshStandardMaterial({ color: 0xe07040, roughness: 0.4, metalness: 0.2 });

// --- XZ Plane (floor, Y=0) ---
const floorGeo = new THREE.PlaneGeometry(20, 20);
const floor = new THREE.Mesh(floorGeo, planeMat.clone());
floor.material.color.set(0x667788);
floor.rotation.x = -Math.PI / 2;
floor.receiveShadow = true;
scene.add(floor);

// --- XY Plane (back wall, Z=-5) ---
const backWall = new THREE.Mesh(new THREE.PlaneGeometry(20, 12), planeMat.clone());
backWall.material.color.set(0x778866);
backWall.position.set(0, 6, -5);
backWall.receiveShadow = true;
scene.add(backWall);

// --- YZ Plane (side wall, X=-5) ---
const sideWall = new THREE.Mesh(new THREE.PlaneGeometry(20, 12), planeMat.clone());
sideWall.material.color.set(0x886677);
sideWall.position.set(-5, 6, 0);
sideWall.rotation.y = Math.PI / 2;
sideWall.receiveShadow = true;
scene.add(sideWall);

// --- Cube ---
const cubeGeo = new THREE.BoxGeometry(2, 2, 2);
const cube = new THREE.Mesh(cubeGeo, cubeMat);
cube.position.set(0, 1, 0);
cube.castShadow = true;
cube.receiveShadow = true;
scene.add(cube);

// --- Sphere ---
const sphereGeo = new THREE.SphereGeometry(1, 32, 32);
const sphereMat = new THREE.MeshStandardMaterial({ color: 0x4090e0, roughness: 0.3, metalness: 0.3 });
const sphere = new THREE.Mesh(sphereGeo, sphereMat);
sphere.position.set(3, 1, -1.5);
sphere.castShadow = true;
sphere.receiveShadow = true;
scene.add(sphere);

// --- Grid helpers (subtle) ---
const gridXZ = new THREE.GridHelper(20, 20, 0x444455, 0x333344);
gridXZ.position.y = 0.01;
scene.add(gridXZ);

// --- Spotlight ---
const spot = new THREE.SpotLight(0xffeedd, 150);
spot.position.set(4, 8, 4);
spot.angle = Math.PI / 4;
spot.penumbra = 0.5;
spot.decay = 1.5;
spot.distance = 40;
spot.castShadow = true;
spot.shadow.mapSize.width = 2048;
spot.shadow.mapSize.height = 2048;
spot.shadow.camera.near = 0.5;
spot.shadow.camera.far = 40;
spot.shadow.bias = -0.0005;
spot.shadow.radius = 4;
scene.add(spot);
scene.add(spot.target);

// Spotlight helper
const spotHelper = new THREE.SpotLightHelper(spot, 0xffff00);
scene.add(spotHelper);

// Small sphere to mark spotlight position
const bulbGeo = new THREE.SphereGeometry(0.15, 16, 16);
const bulbMat = new THREE.MeshBasicMaterial({ color: 0xffffcc });
const bulb = new THREE.Mesh(bulbGeo, bulbMat);
scene.add(bulb);

// --- Controls binding ---
const el = id => document.getElementById(id);

function updateFromUI() {
  const x  = parseFloat(el('sx').value);
  const y  = parseFloat(el('sy').value);
  const z  = parseFloat(el('sz').value);
  const txx = parseFloat(el('tx').value);
  const tyy = parseFloat(el('ty').value);
  const tzz = parseFloat(el('tz').value);
  const ang = parseFloat(el('angle').value);
  const pen = parseFloat(el('penumbra').value);
  const inten = parseFloat(el('intensity').value);

  spot.position.set(x, y, z);
  spot.target.position.set(txx, tyy, tzz);
  spot.angle = THREE.MathUtils.degToRad(ang);
  spot.penumbra = pen;
  spot.intensity = inten;

  bulb.position.copy(spot.position);

  el('vx').textContent = x.toFixed(1);
  el('vy').textContent = y.toFixed(1);
  el('vz').textContent = z.toFixed(1);
  el('vtx').textContent = txx.toFixed(1);
  el('vty').textContent = tyy.toFixed(1);
  el('vtz').textContent = tzz.toFixed(1);
  el('va').textContent = ang + '°';
  el('vp').textContent = pen.toFixed(2);
  el('vi').textContent = inten;
}

['sx','sy','sz','tx','ty','tz','angle','penumbra','intensity'].forEach(id => {
  el(id).addEventListener('input', updateFromUI);
});

updateFromUI();

// --- Animation loop ---
function animate() {
  requestAnimationFrame(animate);
  controls.update();
  spotHelper.update();
  renderer.render(scene, camera);
}
animate();

// --- Resize ---
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>
